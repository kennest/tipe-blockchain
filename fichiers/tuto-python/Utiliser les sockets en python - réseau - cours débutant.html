<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js"><!--<![endif]--><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><script src="Utiliser%20les%20sockets%20en%20python%20-%20r%C3%A9seau%20-%20cours%20d%C3%A9butant_fichiers/adsbygoogle_002.js" async=""></script><script src="Utiliser%20les%20sockets%20en%20python%20-%20r%C3%A9seau%20-%20cours%20d%C3%A9butant_fichiers/adsbygoogle_003.js" async=""></script>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Utiliser les sockets en python - réseau - cours débutant</title>
        <meta name="description" content="Utiliser les sockets en python - réseau - cours débutant">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta charset="utf-8">
        <meta name="Keywords" content="sockets,port,réseaux,python">
        <meta http-equiv="Content-Language" content="fr">
        <meta name="robots" content="index, follow">
        <meta name="audience" content="All">
        <meta name="rating" content="All">
        <meta name="revisit-after" content="2 days">
        <meta name="author" content="Olivier ENGEL">
        <link href="https://plus.google.com/+EngelOlivier/posts" rel="author"> 
        <link href="https://plus.google.com/+EngelOlivier/posts" rel="publisher"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="image_src" href="Utiliser%20les%20sockets%20en%20python%20-%20r%C3%A9seau%20-%20cours%20d%C3%A9butant_fichiers/apprendre-python.png">
        <meta property="og:image" content="/images/apprendre-python.png">
        <!--

        <link rel="stylesheet" href="css/bootstrap.min.css">
        <link rel="stylesheet" href="css/bootstrap-theme.min.css">
        <link rel="stylesheet" href="css/main.css?v1">
        <link rel="stylesheet" href="css/font-awesome/css/font-awesome.min.css">
       
        <script src="js/vendor/modernizr-2.6.2-respond-1.1.0.min.js"></script>
         <link href='http://fonts.googleapis.com/css?family=Raleway:700' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Lato:400italic' rel='stylesheet' type='text/css'>
        -->


        

<style type="text/css">
@font-face 
{
font-family: "opensansregular";
src: url("/fonts/OpenSans-Regular.ttf");
}
html{padding:0px;margin:0px;  }
a{color:#428bca;text-decoration:none;}
body{ 
margin:0px;
padding:0px;
font-family: "opensansregular", serif; 
font-size:17px ; 
line-height:1.42857143;
color:#333;
background-color:#fff;
padding-bottom:20px;}
#menu_main li a{font-size:0.9em;}
ul{padding:0px;margin:0px;}
p{margin:0 0 10px;}
li{list-style-type:none;padding-left:10px;}
h1, h2, h3 {font-weight:500;line-height:1.1;margin-top:30px !important;margin-bottom:10px !important;}
h1{font-size:2em !important;}
h2{font-size:1.5em !important;}
#page{max-width:1000px;padding:20px;padding-top:0px;margin-top:0px;}
#page p{text-align:justify;}
#page h3{font-size:1.2em !important;margin-top:10px;margin-bottom:10px;}
.breadcrumb{padding:2px !important;margin-bottom:10px !important;}
.links_top{
background-color:#f8f8f8;height:40px;line-height:40px;padding:0px 10px;font-size:13px;margin-top:20px;margin-bottom:20px;
clear:both;
}
#menu_main{position:relative;}
@media (max-width:500px){.float-center{float:none !important;position:relative;clear:both;}
}
@media (min-width:993px){#page{margin-left:230px;}
#menu_main{position:fixed;top:0px;left:0px;width:220px;background-color:#eee;overflow:hidden;margin-top:0px;padding:0px;padding-left:10px;vertical-align:middle !important;border-right:1px solid #ccc;overflow-x:hidden;}
#menu_main h3{padding-left:0px;font-size:20px;font-weight:800 !important;line-height:20px !important;}
#menu_main li{padding-left:0px;}
#menu_main li a{width:100%;display:block;color:#333;}
#menu_main li a:hover{background-color:#ccc;text-decoration:none;}
}
@media (max-width:992px){#page{padding:10px;}
.container{margin:0px;padding:0px;}
.row{margin:0px;padding:0px;}
.row > div{margin:0px;padding:0px;}
#logo_menu{display:none;}
#menu_main{width:100%;}
#menu_main h3{width:100%;text-align:center;}
#menu_main li{width:100%;text-align:center;}
#menu_main li a{width:100%;text-align:center;padding:2px;display:block;-webkit-transition-property:background-color;-webkit-transition-duration:0.5;-moz-transition-property:background-color;-moz-transition-duration:0.5s;transition-property:background-color;transition-duration:0.5s;width:100%;text-align:center;display:block;padding:6px;background-color:#f8f8f8;border:1px solid #ccc;font-size:1.2em;color:#111;text-decoration:none;margin:-1px 0px 0px -1px;}
}
@media (min-width:600px) and (max-width:800px){.row > div{width:50%;float:left;}
}
@media (min-width:800px) and (max-width:1000px){.row > div{width:33%;float:left;}
}
@media (min-width:992px){.row{width:100%;margin:0px;padding:0px;}
}
@media (max-width:992px){#menu_main{height:auto;}
}
.breadcrumb{padding:6px 6px;background-color:white !important;}
.breadcrumb-list{padding-top:15px;padding-bottom:5px;}
#category_menu{width:100%;max-width:500px;margin:auto;margin-top:40px;}
#category_menu li{width:100%;}
#category_menu a{-webkit-transition-property:background-color;-webkit-transition-duration:0.5;-moz-transition-property:background-color;-moz-transition-duration:0.5s;transition-property:background-color;transition-duration:0.5s;width:100%;text-align:center;display:block;padding:6px;background-color:#f8f8f8;border:1px solid #ccc;font-size:1.2em;color:#111;text-decoration:none;margin:-1px 0px 0px -1px;}
#category_menu a:hover{background-color:white;}
#pub_right{display:none;text-align:right;}
@media (min-width:1100px) and (max-width:1500px){
  #pub_right{display:block;width:160px;position:fixed;top:0px;right:0px;}
}
@media (min-width:1500px){
  #pub_right{display:block;width:300px;position:fixed;top:0px;right:0px;}
}
@media (min-width:1100px){#page{max-width:700px;}
}
@media (min-width:1150px){#page{max-width:750px;}
}
@media (min-width:1200px){#page{max-width:800px;}
}
@media (min-width:1250px){#page{max-width:850px;}
}
@media (min-width:1300px){#page{max-width:900px;}
}
@media (min-width:1350px){#page{max-width:950px;}
}
@media (min-width:1400px){#page{max-width:1000px;}
}
@media (min-width:1450px){#page{max-width:1050px;}
}
@media (min-width:1500px){#page{max-width:950px;}
}
@media (min-width:1550px){#page{max-width:1000px;}
}
@media (min-width:1600px){#page{max-width:1050px;}
}
@media (min-width:1650px){#page{max-width:1100px;}
}
@media (min-width:1700px){#page{max-width:1150px;}
}
@media (min-width:1750px){#page{max-width:1200px;}
}
@media (max-width:500px){#h1-title-programmation-cours{text-align:center;}
#python-programmation-logo{float:none;margin:auto;margin-bottom:30px;}
}
*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;}
pre{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;word-break:break-all;word-wrap:break-word;color:#333;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;}
pre{margin-top:20px;margin-bottom:20px;}
pre{border:none;border-radius:0px;background-color:#efefef;}
pre {-moz-tab-size: 3 !important;  -o-tab-size: 3 !important;  tab-size: 3 !important; }
img { vertical-align: middle; }

@media (max-width: 1000px) { 
  footer{text-align:center; }
}



#menu_top_container {
  display:none;
  position: absolute;
  z-index: 99;
  width: 100%;
  background-color: #493E3A !important;
  text-align: center;
  top: 0px;
}

#menu_top a {
  position: relative;
  display: inline-block;
  padding: 2px 15px;
  font-size: 1.8em;
  margin-top: 0px;
  float: left;
  height: 100%;
  color: white;
  font-weight: bold;
}

@media (max-width: 375px) {
  #menu_top a {
    padding: 2px 8px;
  }
}
@media (max-width: 300px) {
  #menu_top a {
    padding: 2px 5px;
  }
}
@media (max-width: 259px) {
  #menu_top a {
    padding: 2px 1px;
  }
}

form[action="/page-contact"] input,
form[action="/page-contact"] textarea
{
  padding:10px;
  border:1px solid #eee;
  outline:none;
  margin:4px auto;
}

a:hover{ text-decoration: none !important; }


@media (max-width: 992px) {

  #menu_main{ padding:0px; }
  #page{ margin-top:30px; }
  #menu_top_container{ display: block; }
}

strong{
  color: #445580 !important;
  background-color: rgba(232, 227, 227, 0.33) !important;
  font-weight:500 !important;
}

p.legende {
   font-weight: normal !important;
   font-size:0.9em;
}
</style>
     


    </head>
    <body>

        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
<div id="menu_top_container">
  <div id="menu_top">
      

      <a href="http://apprendre-python.com/"><i class="fa fa-home"></i></a>

<a title="Python" href="http://apprendre-python.com/page-cours-python-debutant-documentation"><img src="Utiliser%20les%20sockets%20en%20python%20-%20r%C3%A9seau%20-%20cours%20d%C3%A9butant_fichiers/logo_python.png"></a>
<a title="Python avancé" href="http://apprendre-python.com/page-cours-python-avance-documentation-francaise"><img src="Utiliser%20les%20sockets%20en%20python%20-%20r%C3%A9seau%20-%20cours%20d%C3%A9butant_fichiers/logo_python_best.png"></a>
<a title="Python Django" href="http://apprendre-python.com/page-django-cours-tutoriels-documentation-francaise"><img src="Utiliser%20les%20sockets%20en%20python%20-%20r%C3%A9seau%20-%20cours%20d%C3%A9butant_fichiers/logo_django.png"></a>
<a title="Python Raspberry pi" href="http://apprendre-python.com/page-raspberry-pi-apprendre-debutant-acheter-python"><img src="Utiliser%20les%20sockets%20en%20python%20-%20r%C3%A9seau%20-%20cours%20d%C3%A9butant_fichiers/logo_raspberry.png" style="margin-right:0px;padding-right:0px;"></a>


      <a href="#" onclick="go_to_menu();return false;" style="float:right;margin-left:0px;padding-left:0px;"><i class="glyphicon glyphicon-align-justify"></i></a>
  </div>
</div>



<div style="position: fixed; top: 0px;" id="pub_right"><div style="width:300px;margin:0px auto;"><script async="" src="Utiliser%20les%20sockets%20en%20python%20-%20r%C3%A9seau%20-%20cours%20d%C3%A9butant_fichiers/adsbygoogle.js"></script><!-- CSSW_BIG_RIGHT --><ins class="adsbygoogle" style="display:inline-block;width:300px;height:600px" data-ad-client="ca-pub-8896261779207088" data-ad-slot="6830797402"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div>

      
    <div id="page">

<h1>Python réseau socket</h1>
      
<!-- breadcrumb -->
<div class="breadcrumb-list" xmlns:v="http://rdf.data-vocabulary.org/#">
  <span class="breadcrumb" typeof="v:Breadcrumb">
    <a rel="v:url" property="v:title" href="http://apprendre-python.com/">Accueil</a>
  </span> 
  <span class="chevron">›</span>
  <span class="breadcrumb" typeof="v:Breadcrumb">
    <a rel="v:url" property="v:title" href="http://apprendre-python.com/page-cours-python-avance-documentation-francaise" title="Voir tous les articles de cette catégorie">
    Python avancé</a>
  </span> 
    <span class="chevron">›</span>
  <span class="breadcrumb-current"><a style="line-height:2.1em;" href="http://apprendre-python.com/page-reseaux-sockets-python-port">Réseau / socket</a></span>
  </div>



<!-- Navigation -->
<div class="links_top">
    <a href="http://apprendre-python.com/page-python-envoyer-mail-smtp" style="float:left;"><i class="glyphicon glyphicon-chevron-left"></i>&nbsp;Envoyer un mail SMTP</a><a href="http://apprendre-python.com/page-database-data-base-donnees-query-sql-mysql-postgre-sqlite" style="float:right;">Base de données&nbsp;<i class="glyphicon glyphicon-chevron-right"></i></a>
</div><p>Le sujet de ce chapitre est de pouvoir utiliser un service sur une machine distante.</p>
<h2>Comment communiquent des machines distantes?</h2>
<p>Des machines distantes peuvent communiquer entre elles grâce à leur <strong>adresse IP</strong>. Une machine <u>cliente</u> (c'est à dire qui demande un service) contacte une machine <u>serveur</u> qui répondra à sa demande. On a donc une logique de <strong>client-serveur</strong>. L'un fait une demande, l'autre lui apporte une réponse.

</p>
<h2>Comment atteindre le bon service?</h2>
<p>Un serveur peut cependant héberger plusieurs services. Par exemple un
 serveur peut héberger un serveur web mais également un serveur de 
messagerie.</p>
<p>Alors comment se connecter au bon service? En utilisant les <strong>ports</strong>.
 Les ports les plus connus sont 21 pour le FTP, 80 pour le HTTP, 443 
pour le HTTPS, le 22 pour le SSH, 110 pour le service POP, etc.</p>
<p>Si vous voulez voir sur quels ports tournent vos services vous pouvez exécuter la commande suivante:</p>
<pre>sudo cat /etc/services
</pre>
<p>L'idée c'est que le client fasse une demande de ce type: <code>192.168.0.1:8888</code> (adresse IP <code>192.168.0.1</code> et port <code>8888</code>) puis de créer un lien entre ce port <code>8888</code> et notre programme.</p>
<p>Pour réaliser ce besoin on utilise des <strong>stockets</strong>.</p>
<h2>Un socket c'est quoi?</h2>
<p>En anglais un <strong>socket</strong> est un "trou" qui laisse passer
 des choses, comme une prise électrique, l'emplacement du processeur, ou
 une bouche -on va s'arrêter la pour les exemples - </p>
<p>Le socket est donc dans notre cas <strong>une association au niveau de l'OS entre un programme qui tourne en boucle et le port de la machine</strong>
 qui lui a été dédié. On dit d'ailleurs que le programme écoute le port 
qui lui a été réservé. Il écoute le port et répond aux demandes faites 
par ce port.</p>
<h2>Socket et python</h2>
<p>Pour comprendre le fonctionnement des <strong>sockets avec python</strong>, nous allons travailler avec deux fichiers: <code>server.py</code> et <code>client.py</code>
<br>
Le premier script sera -comme son nom l'indique- sur le serveur et écoutera les demandes des clients.
<br>
Le script <code>client.py</code> sera donc exécuté sur la machine cliente, c'est lui qui fera la demande du service du serveur distant.</p>
<p>Inutile de préciser que la logique client/serveur fonctionne également sur une même machine.</p>
<p class="legende">server.py</p>
<pre class="code"><span class="c">#!/usr/bin/env python</span>
<span class="c"># coding: utf-8</span>

<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">socket</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s">''</span><span class="p">,</span> <span class="mi">15555</span><span class="p">))</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">socket</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">client</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">"{} connected"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span> <span class="n">address</span> <span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span> <span class="o">!=</span> <span class="s">""</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">response</span>

<span class="k">print</span> <span class="s">"Close"</span>
<span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">stock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre>
<p class="legende">client.py</p>
<pre class="code"><span class="c">#!/usr/bin/env python</span>
<span class="c"># coding: utf-8</span>

<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">hote</span> <span class="o">=</span> <span class="s">"localhost"</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">15555</span>

<span class="n">socket</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">socket</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">hote</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
<span class="k">print</span> <span class="s">"Connection on {}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>

<span class="n">socket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">u"Hey my name is Olivier!"</span><span class="p">)</span>

<span class="k">print</span> <span class="s">"Close"</span>
<span class="n">socket</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre>


<p>Si vous exécutez ces deux programmes vous verrez donc la demande du client se réaliser côté serveur.</p>

<h2>Socket et Threading</h2>
<p>Le problème de l'exemple précédent est que chaque connection doit 
être traitée avant de pouvoir passer à la suivante. Si pour un socket 
maison cela peut être acceptable, pour des projets ambitieux il est 
plutôt conseillé de passer par des <strong>threading</strong>.</p>
<p>Exemple:</p>
<p class="legende">server.py</p>
<pre class="code"><span class="c">#!/usr/bin/env python</span>
<span class="c"># coding: utf-8 </span>

<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="k">class</span> <span class="nc">ClientThread</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">clientsocket</span><span class="p">):</span>

        <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clientsocket</span> <span class="o">=</span> <span class="n">clientsocket</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[+] Nouveau thread pour </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="p">))</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
   
        <span class="k">print</span><span class="p">(</span><span class="s">"Connection de </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">"</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="p">))</span>

        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clientsocket</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">2048</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Ouverture du fichier: "</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="s">"..."</span><span class="p">)</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clientsocket</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

        <span class="k">print</span><span class="p">(</span><span class="s">"Client déconnecté..."</span><span class="p">)</span>

<span class="n">tcpsock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">tcpsock</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">tcpsock</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s">""</span><span class="p">,</span><span class="mi">1111</span><span class="p">))</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">tcpsock</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span> <span class="s">"En écoute..."</span><span class="p">)</span>
    <span class="p">(</span><span class="n">clientsocket</span><span class="p">,</span> <span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span> <span class="o">=</span> <span class="n">tcpsock</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
    <span class="n">newthread</span> <span class="o">=</span> <span class="n">ClientThread</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">clientsocket</span><span class="p">)</span>
    <span class="n">newthread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre>
<p class="legende">client.py</p>
<pre class="code"><span class="c">#!/usr/bin/env python</span>
<span class="c"># coding: utf-8</span>

<span class="kn">import</span> <span class="nn">socket</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">""</span><span class="p">,</span> <span class="mi">1111</span><span class="p">))</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Le nom du fichier que vous voulez récupérer:"</span><span class="p">)</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"&gt;&gt; "</span><span class="p">)</span> <span class="c"># utilisez raw_input() pour les anciennes versions python</span>
<span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">file_name</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="s">'data/</span><span class="si">%s</span><span class="s">'</span> <span class="o">%</span> <span class="p">(</span><span class="n">file_name</span><span class="p">,)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">9999999</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span><span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">_file</span><span class="p">:</span>
    <span class="n">_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Le fichier a été correctement copié dans : </span><span class="si">%s</span><span class="s">."</span> <span class="o">%</span> <span class="n">file_name</span><span class="p">)</span>
</pre>
<p>
Alors que font ces deux scripts? Le script <code>server.py</code> a pour vocation d'être exécuté en boucle pour pouvoir écouter le port <code>1111</code>. 

Ce genre de script peut être implémenté comme <strong>daemon</strong>, c'est à dire un script qui tourne en arrière-plan comme le ferait un serveur web par exemple.

</p>
<p>
Une fois le script <code>server.py</code> lancé sur le serveur, vous pouvez exécuter le script <code>client.py</code> - <i>sur votre machine cliente</i> - qui demandera à <u>accéder au service du serveur via le port 1111</u>.</p>
<p>Un input demande alors quel fichier l'utilisateur veut copier du 
serveur vers sa machine ; ce nom est envoyé aussitôt au serveur. Ce 
dernier envoie le contenu du fichier au client qui récupère ce contenu 
pour créer une copie du fichier dans le dossier <i>data</i>. 
</p>
<p>On utilise le module <code>threading</code> pour pouvoir <u>gérer plusieurs demandes en même temps</u>. Dans le cas contraire il faudrait attendre que chaque demande soit executée dans l'ordre pour pouvoir profiter du service.</p>
<h2>Les méthodes de l'objet socket:</h2>
<pre>accept()                               : accepte une connection, retourne un nouveau socket et une adresse client 
bind(addr)                             : associe le socket à une adresse locale
close()                                : ferme le socket
connect(addr)                          : connecte le socket à une adresse distante 
connect_ex(addr)                       : connect, retourne un code erreur au lieu d'une exception
dup()                                  : retourne un nouveau objet socket identique à celui en cours
fileno()                               : retourne une description du fichier
getpeername()                          : retourne l'adresse distante
getsockname()                          : retourne l'adresse locale
getsockopt(level, optname[, buflen])   : retourne les options du socket
gettimeout()                           : retourne le timeout ou none
listen(n)                              : commence à écouter les connections entrantes
makefile([mode, [bufsize]])            : retourne un fichier objet pour le socket
recv(buflen[, flags])                  : recoit des données
recv_into(buffer[, nbytes[, flags]])   : recoit des données (dans un buffer)
recvfrom(buflen[, flags])              : reçoit des données et l'adresse de l'envoyeur
recvfrom_into(buffer[,nbytes,[,flags]) : reçoit des données et l'adresse de l'envoyeur (dans un buffer)
sendall(data[, flags])                 : envoye toutes les données
send(data[, flags])                    : envoye des données mais il se peut que pas toutes le soit
sendto(data[, flags], addr)            : envoye des données à une adresse donnée
setblocking(0 | 1)                     : active ou désactive le blocage le flag I/O
setsockopt(level, optname, value)      : définit les options du socket
settimeout(None | float)               : active ou désactive le timeout
shutdown(how)                          : fermer les connections dans un ou les deux sens.
</pre>

<!-- Navigation -->
<div class="links_top">
    <a href="http://apprendre-python.com/page-python-envoyer-mail-smtp" style="float:left;"><i class="glyphicon glyphicon-chevron-left"></i>&nbsp;Envoyer un mail SMTP</a><a href="http://apprendre-python.com/page-database-data-base-donnees-query-sql-mysql-postgre-sqlite" style="float:right;">Base de données&nbsp;<i class="glyphicon glyphicon-chevron-right"></i></a>
</div><div class="pub_leader hidden-xs" style="margin:20px auto;position:relative;width:728px;height:90px;clear:both;"><script async="" src="Utiliser%20les%20sockets%20en%20python%20-%20r%C3%A9seau%20-%20cours%20d%C3%A9butant_fichiers/adsbygoogle.js"></script><!-- leader_cssw --><ins class="adsbygoogle" style="display:inline-block;width:728px;height:90px" data-ad-client="ca-pub-8896261779207088" data-ad-slot="7642892606"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div>

 <div class="container ps-container ps-active-y" id="menu_main" style="height: 100%;">
   
  <a id="logo_menu" href="http://apprendre-python.com/" title="Cours python pour débutants et experts"><img title="Apprendre python django cours débutant raspberry pi tutoriels " src="Utiliser%20les%20sockets%20en%20python%20-%20r%C3%A9seau%20-%20cours%20d%C3%A9butant_fichiers/apprendre-python.png"></a>
   <br>


      
      <div class="">
        <div class="">      
                <h3>Python débutant</h3>                <ul>
        <li><a href="http://apprendre-python.com/" title="Introduction programmation apprendre cours tutoriel python">Présentation Python</a></li><li><a href="http://apprendre-python.com/page-apprendre-installer-python-ordinateur" title="Installer Python sur votre ordinateur">Installer Python</a></li><li><a href="http://apprendre-python.com/page-utiliser-interpreteur-python" title="Interpréteur python">Interpréteur python</a></li><li><a href="http://apprendre-python.com/page-editeurs-python-gratuits-payants-ide" title=" Editeurs IDE Python">Editeurs python</a></li><li><a href="http://apprendre-python.com/page-apprendre-variables-debutant-python" title="Calculs et variables python">Calculs et variables</a></li><li><a href="http://apprendre-python.com/page-apprendre-listes-list-tableaux-tableaux-liste-array-python-cours-debutant" title="Les listes python">Les listes</a></li><li><a href="http://apprendre-python.com/page-apprendre-tuples-tuple-python" title="Les tuples python">Les tuples</a></li><li><a href="http://apprendre-python.com/page-apprendre-dictionnaire-python" title="Les dictionnaires python">Les dictionnaires</a></li><li><a href="http://apprendre-python.com/page-apprendre-creer-fonction-en-python" title="Les fonctions python">Les fonctions</a></li><li><a href="http://apprendre-python.com/page-builtin-built-in-fonctions-internes-python" title="Les fonctions prédéfinies de python">Les fonctions prédéfinies</a></li><li><a href="http://apprendre-python.com/page-apprendre-conditions-structures-conditionnelles-if-else-python-cours-debutant" title="IF ELIF ELSE Python Conditions">Conditions if elif else</a></li><li><a href="http://apprendre-python.com/page-apprendre-boucles-python-loop" title="Les boucles for et while Python">Boucle for / while</a></li><li><a href="http://apprendre-python.com/page-python-modules-package-module-cours-debutants-informatique-programmation" title="Les modules et les packages en python">Les modules/packages</a></li><li><a href="http://apprendre-python.com/page-apprendre-exceptions-except-python-cours-debutant" title="Les exceptions python">Les exceptions</a></li><li><a href="http://apprendre-python.com/page-comprehension-list-listes-python-cours-debutants" title="Les compréhensions de liste python">Les compréhensions de liste</a></li><li><a href="http://apprendre-python.com/page-apprendre-programmation-orientee-objet-poo-classes-python-cours-debutants" title="Programmation orientée objet en python /  classes">Programmation orientée objet</a></li><li><a href="http://apprendre-python.com/page-decorateurs-decorator-python-cours-debutants" title="Les décorateurs python">Les décorateurs</a></li><li><a href="http://apprendre-python.com/page-iterateurs-iterator-generateur-generator-python" title="Les itérateurs et les générateurs python">Les itérateurs/générateurs</a></li><li><a href="http://apprendre-python.com/page-expressions-regulieres-regular-python" title="Les expressions régulières en python">Expressions régulières</a></li><li><a href="http://apprendre-python.com/page-lire-ecrire-creer-fichier-python" title="Créer lire et écrire dans un fichier en python">Lire / Editer un fichier</a></li>        </ul>

          
        </div>
        <div class="">
                  <h3>Python avancé</h3>                  <ul>
          <li><a href="http://apprendre-python.com/page-syntaxe-differente-python2-python3-python-differences" title="Différences entres python 2 et python 3">Différences python 2 / 3</a></li><li><a href="http://apprendre-python.com/page-python-encodage-encode-decode-unicode-ascii-codec-character-accents-probleme-string-utf8" title="Encodage python">Encodage python</a></li><li><a href="http://apprendre-python.com/page-pip-installer-librairies-automatiquement" title="Pip installe vos librairies en toute simplicité">Pip installe vos librairies</a></li><li><a href="http://apprendre-python.com/page-virtualenv-python-environnement-virtuel" title="Environnement virtuel en python">Virtualenv</a></li><li><a href="http://apprendre-python.com/page-debogueur-debugger-debug-python-ipython-pdb-pdbpp-cours-tutoriel-script" title="Debug Python ipdb">Debug</a></li><li><a href="http://apprendre-python.com/page-python-path-pythonpath" title="Python path">Python Path</a></li><li><a href="http://apprendre-python.com/page-gestion-fichiers-dossiers-python" title="Gestion des fichiers et des dossiers en python">Gestion fichiers et dossiers</a></li><li><a href="http://apprendre-python.com/page-tkinter-interface-graphique-python-tutoriel" title="Interface graphique Tkinter python">Interface graphique tKinter</a></li><li><a href="http://apprendre-python.com/page-creer-graphiques-scientifiques-python-apprendre" title="Créer des graphiques scientifiques avec python">Graphiques scientifiques</a></li><li><a href="http://apprendre-python.com/page-programmation-asynchrone-python-thread-threading" title="La programmation asynchrone avec python">Programmation asynchrone</a></li><li><a href="http://apprendre-python.com/page-xml-python-xpath" title="XML et python">XML et python</a></li><li><a href="http://apprendre-python.com/page-beautifulsoup-html-parser-python-library-xml" title="BeautifulSoup / parser vos XML et HTML">BeautifulSoup / HTML parser</a></li><li><a href="http://apprendre-python.com/page-cx_freeze-creer-executables-python-cours-apprendre" title="Créer des exécutables python avec cx_Freeze">Créer un exécutable</a></li><li><a href="http://apprendre-python.com/page-dossier-partage-samba-reseau-python-fstab" title="Dossier partagé / samba">Dossier partagé / samba</a></li><li><a href="http://apprendre-python.com/page-python-ftp-creer-copier-voir-dossier-folder-fichiers" title="FTP et python">FTP</a></li><li><a href="http://apprendre-python.com/page-python-ssh-connect-host-distant-sftp-os-fabric-client" title="Fabric SSH python">Fabric SSH</a></li><li><a href="http://apprendre-python.com/page-python-envoyer-mail-smtp" title="Envoyer un mail par SMTP en python">Envoyer un mail SMTP</a></li><li style="background-color: rgb(153, 255, 153);"><a href="http://apprendre-python.com/page-reseaux-sockets-python-port" title="Python réseau socket">Réseau / socket</a></li><li><a href="http://apprendre-python.com/page-database-data-base-donnees-query-sql-mysql-postgre-sqlite" title="Base de données et Python">Base de données</a></li><li><a href="http://apprendre-python.com/page-python-serveur-web-creer-rapidement" title="Créer un serveur web rapidement en python">Créer un serveur web</a></li><li><a href="http://apprendre-python.com/page-websocket-python-crossbar-push-socket-publish-subscribe-call-remote-register-wamp" title="Websocket Python avec Crossbar">Websocket &amp; Crossbar</a></li>          </ul>
       </div>
        <div class="">
                  <h3>Django</h3>                  <ul>
          <li><a href="http://apprendre-python.com/page-django-introduction-python" title="Présentation de django">Présentation Django</a></li><li><a href="http://apprendre-python.com/page-django-installer-python" title="Installer django">Installer Django</a></li><li><a href="http://apprendre-python.com/page-django-initialiser-creer-python" title="Initialiser un projet django">Initialiser un projet Django</a></li><li><a href="http://apprendre-python.com/page-django-application-creer-python" title="Créer une application Django">Créer une application Django</a></li><li><a href="http://apprendre-python.com/page-django-orm-apprendre-base-donnees-database-queryset-modeles" title="ORM Django">ORM Django</a></li><li><a href="http://apprendre-python.com/page-django-login-authentification-de-base-apprendre-creer-cours-tutoriel-python" title="Login Django">Login Django</a></li><li><a href="http://apprendre-python.com/page-django-champs-modeles-orm-model" title="Le champ des modèles Django">Les champs des modèles</a></li><li><a href="http://apprendre-python.com/page-django-interface-admin-administration-settings-django-contrib-auth" title="Interface admin Django">Interface admin Django</a></li><li><a href="http://apprendre-python.com/page-django-query-set-queryset-manager" title="Django Queryset">Queryset</a></li><li><a href="http://apprendre-python.com/page-django-many-to-many-manytomany-relation-relationships-orm" title="Many to Many Django">Many to many relation</a></li><li><a href="http://apprendre-python.com/page-django-vues-views-generic-generiques-python" title="Les vues Django">Les vues</a></li><li><a href="http://apprendre-python.com/page-django-formulaires-forms-champs-fields" title="Les formulaires Django">Les formulaires</a></li><li><a href="http://apprendre-python.com/page-django-csrf-token-securite-formulaires-python-ajax-post-jquery-anguarjs" title="CSRF Token sécurité Django">CSRF Token</a></li><li><a href="http://apprendre-python.com/page-django-middlewares-vues-views-request-response-process-before-after-avant-apres" title="Middleware Django">Les middlewares</a></li><li><a href="http://apprendre-python.com/page-django-templates-structure-template-HTML-variables-boucles-tags-filtre-page-dry-application-projet-modifier-dossier" title="Templates Django">Templates Django</a></li><li><a href="http://apprendre-python.com/page-django-context-processor-template" title="Context Processor Django">Context Processor</a></li><li><a href="http://apprendre-python.com/page-django-signaux-signal-signals-python-cours-apprendre-tutoriel-example" title="Signaux Django">Signaux Django</a></li><li><a href="http://apprendre-python.com/page-django-xadmin-bootstrap-twitter-theme-export-xls-csv-xml-python-web-plugin" title="Xadmin Django thème bootstrap twitter">Xadmin</a></li><li><a href="http://apprendre-python.com/page-django-admin-select2-admin-ajax-many-to-many-foreign-key-form-widget-django_select2" title="Select2 et Django">Django select2</a></li><li><a href="http://apprendre-python.com/page-django-crispy-form-formulaire-bootstrap-twitter-html-fieldset-inline-dynamique-template" title="Crispy Form Django">Crispy Forms</a></li><li><a href="http://apprendre-python.com/page-django-angularjs-angular-js-coffee-script-coffeescript-python-cours-tuto-tutoriel-exemples" title="AngularJS et Django">AngularJS et Django</a></li><li><a href="http://apprendre-python.com/page-django-comment-uploader-fichier-image-cours-apprendre-python-upload-file" title="Upload un fichier en Ajax avec Django">Uploader un fichier en ajax</a></li><li><a href="http://apprendre-python.com/page-django-rest-framework-drf-cours-tuto-tutoriel-exemples" title="Django REST Framework DRF API">Django Rest Framework</a></li><li><a href="http://apprendre-python.com/page-django-deploiement-python-mise-en-production-linux-gunicorn-supervisor-nginx-installer-configurer-serveur-http-web" title="Django déploiement Gunicorn Supervisor Nginx WSGI">Django déploiement </a></li>          </ul>
        </div>

       <div class="">
                  <h3>Raspberry pi</h3>                  <ul>
          <li><a href="http://apprendre-python.com/page-raspberry-pi-presentation-python-c-est-quoi-apprendre-nano-ordinateur-video" title="Présentation raspberry pi">Présentation Raspberry pi</a></li><li><a href="http://apprendre-python.com/page-raspberry-pi-install-installer-debian-linux-windows-ubuntu" title="Installer raspbian (OS linux) sur raspberry pi">Installer Raspbian</a></li><li><a href="http://apprendre-python.com/page-raspberry-pi-adresse-ip-statique-address-static" title="Addresse IP statique / raspberry pi">IP statique</a></li><li><a href="http://apprendre-python.com/page-raspberry-pi-partage-share-dossier-folder-samba-debian" title="Partager un dossier debian / raspberry pi">Samba / partager un dossier</a></li><li><a href="http://apprendre-python.com/page-raspberry-pi-lecture-lire-video-1080p-full-hd-omxplayer-ligne-commande" title="OMXPlayer FULL HD 1080px raspberry pi">Lire vidéo 1080p</a></li><li><a href="http://apprendre-python.com/page-raspberry-pi-installer-vpn-dns-openvpn-debian-python" title="Installer VPN raspberry pi">Installer VPN</a></li><li><a href="http://apprendre-python.com/page-raspberry-pi-installer-client-torrent-transmission-download-dl-python" title="Installer et utiliser un client torrent">Client torrent</a></li>          </ul>
        </div>
        <div class="">
                  <h3>Site</h3>                  <ul>
          <li><a href="http://apprendre-python.com/page-contact" title="Contact">Contacter l'auteur</a></li>          </ul>
        </div>

      </div>
    <div style="width: 209px; display: none; left: 0px; bottom: -961px;" class="ps-scrollbar-x-rail"><div style="left: 0px; width: 0px;" class="ps-scrollbar-x"></div></div><div style="top: 964px; height: 877px; display: inherit; right: 3px;" class="ps-scrollbar-y-rail"><div style="top: 440px; height: 400px;" class="ps-scrollbar-y"></div></div></div> <!-- /container --> 


<hr>





      <div style="clear:both;">
        <footer>
         
         <h3>   Auteur: </h3>
       

<p style="text-align:center;">
<!-- Placez cette balise dans l'en-tête ou juste avant la balise de fermeture du corps de texte. -->
<script async="" src="Utiliser%20les%20sockets%20en%20python%20-%20r%C3%A9seau%20-%20cours%20d%C3%A9butant_fichiers/cbgapi.loaded_1"></script><script async="" src="Utiliser%20les%20sockets%20en%20python%20-%20r%C3%A9seau%20-%20cours%20d%C3%A9butant_fichiers/cbgapi.loaded_0"></script><script src="Utiliser%20les%20sockets%20en%20python%20-%20r%C3%A9seau%20-%20cours%20d%C3%A9butant_fichiers/analytics.js" async=""></script><script gapi_processed="true" src="Utiliser%20les%20sockets%20en%20python%20-%20r%C3%A9seau%20-%20cours%20d%C3%A9butant_fichiers/platform.js" async="" defer="defer">
  {lang: 'fr'}
</script>

<!-- Placez cette balise où vous souhaitez faire apparaître le gadget widget. -->
</p><div id="___person_0" style="text-indent: 0px; margin: 0px; padding: 0px; background: none repeat scroll 0% 0% transparent; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline; display: inline-block; width: 273px; height: 106px;"><iframe title="+Badge" data-gapiattached="true" src="Utiliser%20les%20sockets%20en%20python%20-%20r%C3%A9seau%20-%20cours%20d%C3%A9butant_fichiers/person.html" name="I0_1458826342476" id="I0_1458826342476" vspace="0" tabindex="0" style="position: static; top: 0px; width: 273px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 106px;" scrolling="no" marginwidth="0" marginheight="0" hspace="0" frameborder="0" width="100%"></iframe></div>
<p></p>


          <p style="color:#ccc;text-align:center;"> Apprendre programmation python - django web   </p>
        </footer>
      </div>
    </div>
     
   

 
<script type="text/javascript">
//<![CDATA[ 
var __current_page = '/page-reseaux-sockets-python-port';
//]]>
</script>
<script async="" src="Utiliser%20les%20sockets%20en%20python%20-%20r%C3%A9seau%20-%20cours%20d%C3%A9butant_fichiers/main.js"></script>


    

<link rel="stylesheet" href="Utiliser%20les%20sockets%20en%20python%20-%20r%C3%A9seau%20-%20cours%20d%C3%A9butant_fichiers/all.css"><iframe tabindex="-1" style="width: 1px; height: 1px; position: absolute; top: -100px;" src="Utiliser%20les%20sockets%20en%20python%20-%20r%C3%A9seau%20-%20cours%20d%C3%A9butant_fichiers/postmessageRelay.html" id="oauth2relay371839685" name="oauth2relay371839685"></iframe></body></html>